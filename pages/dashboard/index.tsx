import React, { useState, useEffect } from 'react';
import {
  useContract,
  useDirectListings,
} from '@thirdweb-dev/react';
import { useAddress } from '@thirdweb-dev/react';
import Head from 'next/head';
import Navbar from '@/components/Navbar';
import MintButton from '@/components/MintButton';
import {
  MUMBAI_DIGITIZE_ETH_ADDRESS,
  MUMBAI_MARKETPLACE_ADDRESS,
} from '@/constant/addresses';
import { PackNFTCard } from '@/components/PackNFT';

export default function index() {
  const { contract: marketplace, isLoading: loadingMarketplace } = useContract(
    MUMBAI_MARKETPLACE_ADDRESS,
    'marketplace-v3'
  );

  const { data: directListings, isLoading: loadingDirectListings } = useDirectListings(
    marketplace,
    {
      tokenContract: MUMBAI_DIGITIZE_ETH_ADDRESS,
    }
  );
  console.log('DirectPack', directListings);

  const address = useAddress();

  return (
    <div>
      <Head>
        <title>Dashboard | Digitize.eth</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/logo.png' />
      </Head>
      <Navbar />

      <div
        className='container'
        style={{
          marginTop: 100,
        }}
      >
        <h1 style={{ fontSize: 30, fontWeight: 'bold', marginLeft: 20 }}>
          Welcome Back,{' '}
          {address
            ? `${address.substring(0, 6)}...${address.substring(
                address.length - 5,
                address.length - 1
              )}`
            : 'Not signed in'}
          !
        </h1>

        <div
          className='row'
          style={{
            backgroundColor: '#111111',
            padding: 20,
            borderRadius: 12,
            display: 'flex',
            alignItems: 'center',
          }}
        >
          <img
            src='dp.png'
            alt='Profile Photo'
            style={{
              width: '20%',
              borderRadius: '50%',
              marginRight: '20px',
            }}
          />
        </div>

        <div className='row' style={{ padding: 20 }}>
          <div
            style={{
              display: 'flex',
              flexDirection: 'row',
              alignItems: 'center',
            }}
          >
            <h4>Your Items</h4>
            <MintButton />
          </div>
          <div>
            <div>
              {!!directListings ? (
                directListings?.map((listing, index) => (
                  <div className='card' key={index}>
                    <PackNFTCard
                      contractAddress={listing.assetContractAddress}
                      tokenId={listing.tokenId}
                      status={listing.status}
                    />
                  </div>
                ))
              ) : (
                <p>Loading...</p>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
